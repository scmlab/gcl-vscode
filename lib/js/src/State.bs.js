// Generated by ReScript, PLEASE EDIT WITH CARE
'use strict';

var VSCode = require("bs-vscode/lib/js/src/VSCode.bs.js");
var Vscode = require("vscode");
var $$Promise = require("reason-promise/lib/js/src/js/promise.bs.js");
var Json_decode = require("@glennsl/bs-json/lib/js/src/Json_decode.bs.js");
var LSP$Guacamole = require("./LSP.bs.js");
var Caml_js_exceptions = require("bs-platform/lib/js/caml_js_exceptions.js");
var Response$Guacamole = require("./Response.bs.js");
var VscodeLanguageclient = require("vscode-languageclient");

function make(param) {
  var setupLSPClient = function (param) {
    var serverOptions = LSP$Guacamole.ServerOptions.makeCommand("gcl");
    var documentSelector = [VSCode.DocumentFilterOrString.documentFilter({
            language: "guacamole",
            pattern: undefined,
            scheme: "file"
          })];
    var synchronize = Vscode.workspace.createFileSystemWatcher('**/.clientrc', false, false, false);
    var clientOptions = LSP$Guacamole.LanguageClientOptions.make(documentSelector, synchronize);
    return new VscodeLanguageclient.LanguageClient("guacamoleLanguageServer", "Guacamole Language Server", serverOptions, clientOptions);
  };
  var client = setupLSPClient(undefined);
  client.start();
  $$Promise.getOk($$Promise.Js.toResult(client.onReady()), (function (param) {
          client.onNotification("guacamole/pos", (function (result) {
                  console.log("pos >>>", result);
                  var exit = 0;
                  var value;
                  try {
                    value = Response$Guacamole.ProofObligation.decode(result);
                    exit = 1;
                  }
                  catch (raw_msg){
                    var msg = Caml_js_exceptions.internalToOCamlException(raw_msg);
                    if (msg.RE_EXN_ID === Json_decode.DecodeError) {
                      console.log(msg._1);
                    } else {
                      throw msg;
                    }
                  }
                  if (exit === 1) {
                    console.log(value);
                  }
                  
                }));
          
        }));
  return {
          client: client
        };
}

function destroy(state) {
  state.client.stop();
  
}

exports.make = make;
exports.destroy = destroy;
/* VSCode Not a pure module */
