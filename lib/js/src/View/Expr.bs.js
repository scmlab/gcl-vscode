// Generated by BUCKLESCRIPT, PLEASE EDIT WITH CARE
'use strict';

var $$Array = require("bs-platform/lib/js/array.js");
var Curry = require("bs-platform/lib/js/curry.js");
var React = require("react");
var Caml_option = require("bs-platform/lib/js/caml_option.js");
var GCL$Guacamole = require("../GCL.bs.js");
var Link$Guacamole = require("./Link.bs.js");
var Util$Guacamole = require("../Util/Util.bs.js");
var Subst$Guacamole = require("./Subst.bs.js");
var Common$Guacamole = require("./Common.bs.js");
var Caml_chrome_debugger = require("bs-platform/lib/js/caml_chrome_debugger.js");

function Expr$Paren(Props) {
  var activate = Props.activate;
  var children = Props.children;
  var match = React.useState((function () {
          return false;
        }));
  var setHover = match[1];
  var match$1 = React.useState((function () {
          return false;
        }));
  var setCollapse = match$1[1];
  var collapsed = match$1[0];
  var onMouseOver = function (param) {
    return Curry._1(setHover, (function (param) {
                  return true;
                }));
  };
  var onMouseLeave = function (param) {
    return Curry._1(setHover, (function (param) {
                  return false;
                }));
  };
  var onClick = function (param) {
    return Curry._1(setCollapse, (function (param) {
                  if (collapsed) {
                    return false;
                  } else {
                    return true;
                  }
                }));
  };
  var className = "expr-paren" + ((
      match[0] ? " hovered" : ""
    ) + (
      collapsed ? " collapsed" : ""
    ));
  if (activate) {
    if (collapsed) {
      return React.createElement("div", {
                  className: className,
                  onClick: onClick,
                  onMouseLeave: onMouseLeave,
                  onMouseOver: onMouseOver
                }, "(...)");
    } else {
      return React.createElement(React.Fragment, undefined, React.createElement("div", {
                      className: className,
                      onClick: onClick,
                      onMouseLeave: onMouseLeave,
                      onMouseOver: onMouseOver
                    }, "("), children, React.createElement("div", {
                      className: className,
                      onClick: onClick,
                      onMouseLeave: onMouseLeave,
                      onMouseOver: onMouseOver
                    }, ")"));
    }
  } else {
    return children;
  }
}

var Paren = {
  make: Expr$Paren
};

function Expr$Low(Props) {
  var value = Props.value;
  return React.createElement("div", undefined, Curry._1(GCL$Guacamole.Syntax.Name.toString, value));
}

var Low = {
  make: Expr$Low
};

function Expr$Operator(Props) {
  var value = Props.value;
  var loc = Props.loc;
  return React.createElement(Link$Guacamole.make, {
              loc: loc,
              children: Curry._1(GCL$Guacamole.Syntax.Op.toString, value)
            });
}

var Operator = {
  make: Expr$Operator
};

function handleOperator(n, op, loc) {
  var makeProps = function (prim, prim$1, prim$2, prim$3) {
    var tmp = {
      prec: prim,
      value: prim$1
    };
    if (prim$2 !== undefined) {
      tmp.key = Caml_option.valFromOption(prim$2);
    }
    return tmp;
  };
  var match = Curry._1(GCL$Guacamole.Syntax.Expr.Precedence.classify, op);
  switch (match.tag | 0) {
    case /* InfixL */0 :
        var m = match[0];
        return Curry._2(GCL$Guacamole.Syntax.VarArg.let_, GCL$Guacamole.Syntax.VarArg.$$var, (function (p) {
                      return Curry._2(GCL$Guacamole.Syntax.VarArg.let_, GCL$Guacamole.Syntax.VarArg.$$var, (function (q) {
                                    return /* Complete */Caml_chrome_debugger.variant("Complete", 1, [React.createElement(Expr$Paren, {
                                                    activate: n > m,
                                                    children: null
                                                  }, React.createElement(make, makeProps(m, p, undefined, /* () */0)), React.createElement(Common$Guacamole.Space.make, { }), React.createElement(Expr$Operator, {
                                                        value: op,
                                                        loc: loc
                                                      }), React.createElement(Common$Guacamole.Space.make, { }), React.createElement(make, makeProps(m + 1 | 0, q, undefined, /* () */0)))]);
                                  }));
                    }));
    case /* InfixR */1 :
        var m$1 = match[0];
        return Curry._2(GCL$Guacamole.Syntax.VarArg.let_, GCL$Guacamole.Syntax.VarArg.$$var, (function (p) {
                      return Curry._2(GCL$Guacamole.Syntax.VarArg.let_, GCL$Guacamole.Syntax.VarArg.$$var, (function (q) {
                                    return /* Complete */Caml_chrome_debugger.variant("Complete", 1, [React.createElement(Expr$Paren, {
                                                    activate: n > m$1,
                                                    children: null
                                                  }, React.createElement(make, makeProps(m$1 + 1 | 0, p, undefined, /* () */0)), React.createElement(Common$Guacamole.Space.make, { }), React.createElement(Expr$Operator, {
                                                        value: op,
                                                        loc: loc
                                                      }), React.createElement(Common$Guacamole.Space.make, { }), React.createElement(make, makeProps(m$1, q, undefined, /* () */0)))]);
                                  }));
                    }));
    case /* Infix */2 :
        var m$2 = match[0];
        return Curry._2(GCL$Guacamole.Syntax.VarArg.let_, GCL$Guacamole.Syntax.VarArg.$$var, (function (p) {
                      return Curry._2(GCL$Guacamole.Syntax.VarArg.let_, GCL$Guacamole.Syntax.VarArg.$$var, (function (q) {
                                    return /* Complete */Caml_chrome_debugger.variant("Complete", 1, [React.createElement(Expr$Paren, {
                                                    activate: n > m$2,
                                                    children: null
                                                  }, React.createElement(make, makeProps(m$2 + 1 | 0, p, undefined, /* () */0)), React.createElement(Common$Guacamole.Space.make, { }), React.createElement(Expr$Operator, {
                                                        value: op,
                                                        loc: loc
                                                      }), React.createElement(Common$Guacamole.Space.make, { }), React.createElement(make, makeProps(m$2 + 1 | 0, q, undefined, /* () */0)))]);
                                  }));
                    }));
    case /* Prefix */3 :
        var m$3 = match[0];
        return Curry._2(GCL$Guacamole.Syntax.VarArg.let_, GCL$Guacamole.Syntax.VarArg.$$var, (function (p) {
                      return /* Complete */Caml_chrome_debugger.variant("Complete", 1, [React.createElement(Expr$Paren, {
                                      activate: n > m$3,
                                      children: null
                                    }, React.createElement(Expr$Operator, {
                                          value: op,
                                          loc: loc
                                        }), React.createElement(Common$Guacamole.Space.make, { }), React.createElement(make, makeProps(m$3, p, undefined, /* () */0)))]);
                    }));
    case /* Postfix */4 :
        var m$4 = match[0];
        return Curry._2(GCL$Guacamole.Syntax.VarArg.let_, GCL$Guacamole.Syntax.VarArg.$$var, (function (p) {
                      return /* Complete */Caml_chrome_debugger.variant("Complete", 1, [React.createElement(Expr$Paren, {
                                      activate: n > m$4,
                                      children: null
                                    }, React.createElement(make, makeProps(m$4, p, undefined, /* () */0)), React.createElement(Common$Guacamole.Space.make, { }), React.createElement(Expr$Operator, {
                                          value: op,
                                          loc: loc
                                        }))]);
                    }));
    
  }
}

function handleExpr(n) {
  var makeProps = function (prim, prim$1, prim$2, prim$3) {
    var tmp = {
      prec: prim,
      value: prim$1
    };
    if (prim$2 !== undefined) {
      tmp.key = Caml_option.valFromOption(prim$2);
    }
    return tmp;
  };
  return (function (param) {
      switch (param.tag | 0) {
        case /* Lit */0 :
            return /* Complete */Caml_chrome_debugger.variant("Complete", 1, [React.createElement(Link$Guacamole.make, {
                            loc: param[1],
                            children: Curry._1(GCL$Guacamole.Syntax.Lit.toString, param[0])
                          })]);
        case /* Var */1 :
        case /* Const */2 :
            break;
        case /* Op */3 :
            var loc = param[1];
            var op = param[0];
            if (n >= 0) {
              return handleOperator(n, op, loc);
            } else {
              return /* Complete */Caml_chrome_debugger.variant("Complete", 1, [React.createElement(Expr$Operator, {
                              value: op,
                              loc: loc
                            })]);
            }
        case /* App */4 :
            var q = param[1];
            var match = handleExpr(n)(param[0]);
            if (match.tag) {
              var s = match[0];
              var match$1 = handleExpr(n)(q);
              if (match$1.tag) {
                var t = match$1[0];
                if (q.tag === /* App */4) {
                  return /* Complete */Caml_chrome_debugger.variant("Complete", 1, [React.createElement(React.Fragment, undefined, s, React.createElement(Expr$Paren, {
                                      activate: true,
                                      children: t
                                    }))]);
                } else {
                  return /* Complete */Caml_chrome_debugger.variant("Complete", 1, [React.createElement(React.Fragment, undefined, s, React.createElement(Common$Guacamole.Space.make, { }), t)]);
                }
              } else {
                return /* Expect */Caml_chrome_debugger.variant("Expect", 0, [match$1[0]]);
              }
            } else {
              return Curry._1(match[0], q);
            }
        case /* Lam */5 :
            return /* Complete */Caml_chrome_debugger.variant("Complete", 1, [React.createElement(Link$Guacamole.make, {
                            loc: param[2],
                            children: null
                          }, "\\", param[0], " -> ", React.createElement(make, makeProps(0, param[1], undefined, /* () */0)))]);
        case /* Hole */6 :
            return /* Complete */Caml_chrome_debugger.variant("Complete", 1, [React.createElement(Link$Guacamole.make, {
                            loc: param[0],
                            children: "[?]"
                          })]);
        case /* Quant */7 :
            return /* Complete */Caml_chrome_debugger.variant("Complete", 1, [React.createElement(Link$Guacamole.make, {
                            loc: param[4],
                            children: null
                          }, "<", React.createElement(Common$Guacamole.Space.make, { }), React.createElement(make, makeProps(-1, param[0], undefined, /* () */0)), React.createElement(Common$Guacamole.Space.make, { }), Util$Guacamole.React.sepBy(React.createElement(Common$Guacamole.Space.make, { }), $$Array.map((function (value) {
                                      return React.createElement(Expr$Low, {
                                                  value: value
                                                });
                                    }), param[1])), React.createElement(Common$Guacamole.Space.make, { }), ":", React.createElement(Common$Guacamole.Space.make, { }), React.createElement(make, makeProps(0, param[2], undefined, /* () */0)), React.createElement(Common$Guacamole.Space.make, { }), ":", React.createElement(Common$Guacamole.Space.make, { }), React.createElement(make, makeProps(0, param[3], undefined, /* () */0)), React.createElement(Common$Guacamole.Space.make, { }), ">")]);
        case /* Subst */8 :
            return /* Complete */Caml_chrome_debugger.variant("Complete", 1, [React.createElement(Link$Guacamole.make, {
                            loc: /* NoLoc */0,
                            children: React.createElement(Subst$Guacamole.make, {
                                  subst: param[1],
                                  makeExpr: make,
                                  makeExprProps: (function (param) {
                                      return (function (param$1) {
                                          var partial_arg = "";
                                          return (function (param$2) {
                                              var param$3 = param$1;
                                              var param$4 = partial_arg;
                                              var param$5 = param$2;
                                              var prim = param;
                                              var prim$1 = param$3;
                                              var prim$2 = param$4;
                                              var tmp = {
                                                prec: prim,
                                                value: prim$1
                                              };
                                              if (prim$2 !== undefined) {
                                                tmp.key = Caml_option.valFromOption(prim$2);
                                              }
                                              return tmp;
                                            });
                                        });
                                    }),
                                  children: React.createElement(make, makeProps(0, param[0], undefined, /* () */0))
                                })
                          })]);
        case /* Unknown */9 :
            return /* Complete */Caml_chrome_debugger.variant("Complete", 1, [React.createElement(Link$Guacamole.make, {
                            loc: /* NoLoc */0,
                            children: "[? " + (JSON.stringify(param[0]) + " ?]")
                          })]);
        
      }
      return /* Complete */Caml_chrome_debugger.variant("Complete", 1, [React.createElement(Link$Guacamole.make, {
                      loc: param[1],
                      children: Curry._1(GCL$Guacamole.Syntax.Name.toString, param[0])
                    })]);
    });
}

function make(Props) {
  var prec = Props.prec;
  var value = Props.value;
  var match = handleExpr(prec)(value);
  if (match.tag) {
    return match[0];
  } else {
    return React.createElement(React.Fragment, undefined);
  }
}

var Prec = {
  handleOperator: handleOperator,
  handleExpr: handleExpr,
  make: make
};

function Expr(Props) {
  var value = Props.value;
  return React.createElement("div", {
              className: "expr"
            }, React.createElement(make, {
                  prec: 0,
                  value: value
                }));
}

var make$1 = Expr;

exports.Paren = Paren;
exports.Low = Low;
exports.Operator = Operator;
exports.Prec = Prec;
exports.make = make$1;
/* react Not a pure module */
