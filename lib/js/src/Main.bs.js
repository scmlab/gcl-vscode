// Generated by BUCKLESCRIPT, PLEASE EDIT WITH CARE
'use strict';

var Curry = require("bs-platform/lib/js/curry.js");
var Vscode = require("vscode");
var Js_dict = require("bs-platform/lib/js/js_dict.js");
var Belt_Array = require("bs-platform/lib/js/belt_Array.js");
var Belt_Option = require("bs-platform/lib/js/belt_Option.js");
var View$GclVscode = require("./View.bs.js");
var State$GclVscode = require("./State.bs.js");
var Command$GclVscode = require("./Command.bs.js");

var dict = { };

function get(editor) {
  return Js_dict.get(dict, editor.document.fileName);
}

function getByFileName(fileName) {
  return Js_dict.get(dict, fileName);
}

function set(fileName, state) {
  dict[fileName] = state;
  return /* () */0;
}

function isLoaded(editor) {
  return Belt_Option.isSome(Js_dict.get(dict, editor.document.fileName));
}

function dispose(param) {
  return Belt_Array.map(Js_dict.entries(dict), (function (param) {
                return State$GclVscode.dispose(param[1]);
              }));
}

var States = {
  dict: dict,
  get: get,
  getByFileName: getByFileName,
  set: set,
  isLoaded: isLoaded,
  dispose: dispose
};

function getState(context) {
  return Belt_Option.map(Vscode.window.activeTextEditor, (function (editor) {
                var match = get(editor);
                if (match !== undefined) {
                  return match;
                } else {
                  var state = State$GclVscode.make(context, editor);
                  set(editor.document.fileName, state);
                  return state;
                }
              }));
}

function activate(context) {
  context.subscriptions.push(Curry._1(Vscode.window.onDidChangeActiveTextEditor, (function (editor) {
              return Belt_Option.forEach(Belt_Option.flatMap(editor, get), View$GclVscode.activate);
            })));
  context.subscriptions.push(Vscode.workspace.onDidCloseTextDocument((function (textDoc) {
              return Belt_Option.forEach(Js_dict.get(dict, textDoc.fileName), State$GclVscode.dispose);
            })));
  context.subscriptions.push(Vscode.commands.registerCommand("extension.load", (function (param) {
              return Belt_Option.forEach(getState(context), Command$GclVscode.load);
            })));
  context.subscriptions.push(Vscode.commands.registerCommand("workbench.action.files.save", (function (param) {
              return Belt_Option.forEach(getState(context), (function (prim) {
                            console.log(prim);
                            return /* () */0;
                          }));
            })));
  return /* () */0;
}

function deactive(param) {
  return dispose(/* () */0);
}

exports.States = States;
exports.getState = getState;
exports.activate = activate;
exports.deactive = deactive;
/* vscode Not a pure module */
